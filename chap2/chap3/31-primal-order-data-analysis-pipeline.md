# 3.1 Assessment of Primary-order Chromatin
Genomic regions with dense nucleo- somes are more tightly packed (i.e., “closed”), whereas nucleosome- depleted regions are more accessible (i.e., “open”) for interactions with regulators and are therefore regarded as the primary locations ofregulatory elements. 

## 3.2.1 Features of data
![](/assets/prios.jpg)
**Figure1.Fragmentation methods and read out features comparison between four methods.**MNase is specially sensitive to open chromotin areas and it is exonucleas which maps regions that are protected by nucleosomes (large open regions are digested). DNase-seq and ATAC-seq are used to sequence and map exposed regions of DNA. 
## 3.2.2 Analytical pipeline:
### Step1 Raw reads (Quality control)

 - Composite plots to check experiment sucess: eg, TSSs shown t be open.----**ArchTEX[108], CEAS[110]**.
 - ATAC-seq can be further: estimating the percentage of sequence reads that map to the mitochondrial genome(lower is better).
 - Use genome browser to see raw tag density ---- **UCSC[121],IGV[122],GIVE**.
 
### Step2 Pre-processing & Alignment 
Reads are filtered to remove redundancy and adaptors, also size selection (selective for some methods).
#### Size selection:
- MNase: 25-50bp fragments represent TF-binding sites.
- ATAC: 
 - reads length below **38bp** are removed,as 38 bp is the minimal distance between neighboring transposition sites generated by the Tn5 transposase[2'].
 - mitochondrial genome reads removed.

#### Alignment 
- **Full-read approach**
 - Bowtie2[57']
 - Burrows-Wheeler Aligner (BWA)[58']
- **Chimeric alignment** (unmapped from previous step, which may contains ligation juction)
 - BWA
 - STAR
 - ChimeraScan【？】
 
#### Minimal reads number 【引用？！】
 - MNase: 150-200 Million reads.
 - DNase / FAIRE: 25-50 M
 - ATAC:  50-160 M
 
 
### Step3 Peak calling 
Peak calling basically means we identify possible open regions or nucleosome location through the tiling reads depth. This step is the most critical for chromatin accessibility profiling, revealing nucleosome-dense, closed regions (MNase-seq) or open chromatin regions (DNase-seq, FAIRE-seq, and ATAC-seq)【'论文本身】.

#### For MNase-seq
##### Midpoint of nucleosome:
- **single-end mode**: shifting the ends 73 bp from 5' end, or extending the ends from 120 to 147 bp in the 3′ direction. 
- **paired end mode**: mid of forward and reverse reads. 

##### Peak calling tools:
<table>
 <tbody>
  <tr>
    <th>Tools</th>
    <th>Description</th>
    <th>Reference</th>
  </tr>
  <tr>
    <td>GeneTrack</td>
    <td><ul><li>Gaussian smoothing</li><li>generate prob-based map based on predefined exclusion distance</li></ul></td><td>[1-4】</td>
  </tr>
  <tr>
    <td>iNPS</td>
    <td><ul><li>wave-like structure of data</li><li>first derivative of the Gaussian smoothed profile</li></ul></td><td>[1-20】</td>
   </tr>  
   <tr>
      <td>DANPOS</td>
      <td><ul><li>identification ofdynamic nucleosomes positions</li></ul></td><td>[1-19】</td>
      </tr>
</tbody>
</table>

#### For DNase-seq and FAIRE-seq
##### Specific tools for DNase-seq
<table>
 <tbody>
  <tr>
    <th>Tools</th>
    <th>Description</th>
    <th>Reference</th>
  </tr>
  <tr>
    <td>F-seq</td>
    <td><ul><li>smooth Gaussian kernel density estimation</li><li>higher accuracy and sensitivity[2-135】</li></ul></td><td>[1-15】</td>
  </tr>
  <tr>
    <td>Hotspot</td>
    <td><ul><li>reports statistical signifi- cance for identified DHSs<br>(DNase I hypersensitive site)</li></ul></td><td>[1-8,49】</td>
   </tr>  
</tbody>
</table>
##### Specific tools for FAIRE-seq
<table>
 <tbody>
  <tr>
    <th>Tools</th>
    <th>Description</th>
    <th>Reference</th>
  </tr>
  <tr>
    <td>MACS2</td>
    <td><ul><li>more parameter settings</li><li>settings can be converted to P-values empirically</li></ul></td><td>[1-132】</td>
  </tr>
</tbody>
</table>

##### General peak calling tools
<table>
 <tbody>
  <tr>
    <th>Tools</th>
    <th>Description</th>
    <th>Reference</th>
  </tr>
  <tr>
    <td>ZINBA</td>
    <td><ul><li>regression model to identify enriched regions without a prior</li><li>regions within a defined dis- tance are combined to form a broad region</li><li>shape-detection function for sharp signals</li><li>can combine prior like GC content when noise is high</li></ul></td><td>[1-72】</td>
  </tr>
  <tr>
    <td>MACS</td>
    <td><ul><li>use Poisson distribution as a background model</li></ul></td><td>[1-8,49】</td>
   </tr>  
</tbody>
</table>




#### For ATAC-seq
Paired-end sequencing is performed for ATAC-seq. The read start sites require **adjustment** because the Tn5 transposase binds as a dimer and inserts adaptors separated by 9bp. Generally, reads aligned to the + strand are offset by +4 bp, and reads aligning to the - strand are offset by −5 bp【文章1】. This method can detect both broad regions (few kilobase) or small regions (50-500bp).
##### Comman peak calling tools:
MACS2, ZINBA, F-seq, HOMER. ["atac-seq"-R package](https://github.com/ blikzen/atac-seq).

### Step4 Chromatin Accessibility Analysis
Accessible regions are determined based on peak-calling results. With peak files we go downstream analysis with different purpose:
<table>
 <tbody>
  <tr>
    <th></th>
    <th>MNase-seq</th>
    <th>DNase-seq</th>
    <th>FAIRE-seq</th>
    <th>ATAC-seq</th>
  </tr>
  <tr>
    <th>Identification<br>Objectives</th>
    <td>Nucleosome positioning</td><td>TF footprint</td><td>CORE locations</td><td>Nucleosome pos and TF footprint</td>
  </tr> 
  <tr>
    <th>Tools</th>
    <td><ul><li>Nucleosome positioning algorithms [2-48,58,111,144】</li><li>Nucleosome occupancy algorithms [2-48,145】</li><li>V-plots for TF occupancy [2-50】</li></ul></td><td><ul><li>Digital genomic footprinting algorithms [19,78,83,85,128,146-149】</li><li>Nucleosome and TF occupancy algorithms [2-150】</li><li>CENTIPEDE [2-151】</li><ul></td>
    <td>Not available</td>
    <td><ul><li>Digital genomic footprinting algorithms</li><li>CENTIPEDE</li></ul></td>
  </tr>
</tbody>
</table>
**V-plots** are two dimensional dot- plots that display each fragment’slengthinthe Y-axis versus the corresponding fragment midpoint position in the X-axis for TF binding detection.
<br>
**CENTIPEDE** is an integrative algorithm for rapid profiling of many TFs simultaneously that combines known information on TF motifs and positional weight matrices
 
 
### Step5 Analysis and Interpretation
Data annotation and integration represents the final and most informative stage of analysis. After we get the nucleosome positions and TF binding sites, it is desireble to further interpret them in the light of relavent information.
- In combination with (promoters, introns, intergenic regions, TSSs, TTSs) information ---- [BedTools](http://bedtools.readthedocs.org/).
- Discovery TF binding events based on known knowledge or *de novo* ways.

## 3.2.3 Analytical Tools for peak calling:
### Brief view of different tools 
A comprehensive list for peak calling softwares can be found at [here](https://omictools.com/peak-calling-category). Few widely-used tools are listed below. 
<table>
  <tbody>
   <tr>
    <td>MACS2 (MACS1.4)</td> <td>Most widely used peak caller. Can detect narrow and broad peaks.</td>
  </tr>
   <tr>
    <td>Epic (SICER)</td>
    <td>Specialised for broad peaks</td>
  </tr>
   <tr>
    <td>BayesPeak R/Bioconductor</td>
    <td>Jmosaics Detects enriched regions jointly from replicates</td>
  </tr>
   <tr>
    <td>EDD</td>
    <td>Detects megabase domain enrichment</td>
  </tr>
   <tr>
    <td>GEM</td><td>Peak calling and motif discovery for ChIP-seq and ChIP-exo</td>
  </tr>
  <tr>
    <td>SPP</td><td>Fragment length computation and saturation analysis to determine if read depth is</td>
  </tr>
  </tbody>
<table>

### Introduction of MACS
MACS is on of the most popular peak calling tools and is developed in  X. Shirley Liu’s lab at Harvard University. We'll use MACS as an example to show you the basic idea behind peak calling and practical implementation. The original paper introduce MACS can be found [here](https://genomebiology.biomedcentral.com/articles/10.1186/gb-2008-9-9-r137).

#### Core idea of the algorithm
The combination of TF and genome is a relatively random process, that's to say that every position on the genome have the chance to be seen by the TF (however, with different probablity). Peak calling is aimed to find those hot spot that is easily seen.

How can we identify whether a spot is "hot"? Suppose we are sequencing a group of cells, then a hot spot is presumably be covered more frequently than other spots. This process can be viewed as a binomial distribution and    when the number of reads *n* is large and the prob *p* of each location to be covered by a read is small, then the binomial distribution became [Poisson distribution](https://en.wikipedia.org/wiki/Poisson_distribution). 
> An event can occur 0, 1, 2, … times in an interval. The average number of events in an interval is designated <math> \lambda </math> (lambda). Lambda is the event rate, also called the rate parameter. The probability of observing {{mvar|k}} events in an interval is given by the equation:    <math>P(k \text{ events in interval}) = e^{-\lambda}\frac{\lambda^k}{k!}</math>

Here the <math> \lambda=n*p, p=\frac{l}{s}</math>. 
- n: the reads number from sequencing.
- l: length of a single read.
- s: length of the whole genome.

With this basic model then we can compute a threshold depth of a spot by setting a confidence probability. Howver, this is only a baby model which may fail in real circumstances due to lots of bias of the experiment. 

#### Bias in ChIP-seq experiment
In doing ChIP-seq analysis, it's important to think about biases that can affect your results. There are a number of issues, such as issues with chromatin accessibility that are going to affect how your DNA gets fragmented, issues with amplification, repetitive regions, which are going to be difficult to map back to. And so it's very important in a ChIP-seq experiment to use some kind of control, and a common control is to use input DNA control, where we have data that's, that is fragmented, but the immunoprecipitation, or the, the antibody pull down has not been performed. (A comprehensive review for bias can be found [here](http://dx.doi.org/10.1038/nrg3788)).

#### Using control data
Determining the background expectation of the number of peaks you would see and use that in making your peak calls. It also allows for MACS to compute a false discovery rate. Without a control, MACS will not compute a false discovery rate. But using a control, it's able to to model that background. 

#### Generate profile from combined tag
Another problem is that, the reads we got do not indicate the real potion of a TF, reads are pulled down together with a TF. In that case we usually get a double peak result which desired further analysis. MACS solved this problem by shifting tags of d/2, where d  is the discrepancy between forward and backward peaks around one TF. An illustration can be seen [here](https://www.nature.com/articles/nrg2641/figures/5).

#### Implementation Pipeline

Intall [MACS](https://github.com/downloads/taoliu)(version 1.4 or 2.0).
```
tar xvzf MACS-1.4.2-1.tar.gz
cd MACS-1.4.2
python setup.py install –prefix /your_directory/
```
Change the enviroment path
```
export PATH = /your_directory/bin:$PATH
export PYTHONPATH = /your_directory/lib/python2.X/site-packages/:$PYTHONPATH
```





# Referrence
https://doi.org/10.1016/j.csbj.2018.02.003 *



